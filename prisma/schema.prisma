// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 範例模型 - 您可以根據需求修改或刪除
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Aquarium {
  id        Int      @id @default(autoincrement())
  name      String
  length    Float    // 魚缸的長度（單位：公分），須 >= 10，最大 2000
  width     Float    // 魚缸的寬度（單位：公分），須 >= 10，最大 2000
  height    Float    // 魚缸的高度（單位：公分），須 >= 5，最大 2000
  status    String   // 魚缸的狀態（開缸、穩定、治療、閒置）
  setupDate String   @map("setup_date") // 魚缸開始使用的日期（格式：YYYY-MM-DD，如 2025-01-01）
  notes     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  waterChanges      WaterChange[]
  organisms         Organism[]
  feedingRecords    FeedingRecord[]
  medicationRecords MedicationRecord[]
  waterQualityRecords WaterQualityRecord[]
  supplies          Supply[]
  equipments        Equipment[]

  @@map("aquariums")
}

model WaterChange {
  id          Int      @id @default(autoincrement())
  date        String   // 換水日期（格式：YYYY-MM-DD）
  waterAmount Float    // 換水量（比例：0.5 表示 1/2、0.33 表示 1/3、1.0 表示全換）
  notes       String?
  aquariumId  Int      @map("aquarium_id")
  aquarium    Aquarium @relation(fields: [aquariumId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("water_changes")
}

model Organism {
  id          Int      @id @default(autoincrement())
  name        String   // 生物名稱
  tag         String   // tag（上層魚、底棲魚、異形、古代魚、蝦...）
  purchaseDate String? @map("purchase_date") // 購買日期（格式：YYYY-MM-DD）
  price       Float?   // 金額
  healthStatus String? @map("health_status") // 健康程度（過胖、過瘦、正常、生病、精神異常、死亡）
  gender      String?  // 性別（雄、雌）
  length      Float?   // 長度（公分）
  notes       String?
  aquariumId  Int      @map("aquarium_id")
  aquarium    Aquarium @relation(fields: [aquariumId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("organisms")
}

model FeedingRecord {
  id         Int      @id @default(autoincrement())
  date       String   // 餵食日期（格式：YYYY-MM-DD）
  supplyId   Int      @map("supply_id") // 使用的耗材ID（必須是 tag 為「飼料」的耗材）
  supply     Supply   @relation(fields: [supplyId], references: [id], onDelete: Cascade)
  notes      String?
  aquariumId Int      @map("aquarium_id")
  aquarium   Aquarium @relation(fields: [aquariumId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("feeding_records")
}

model MedicationRecord {
  id         Int      @id @default(autoincrement())
  name       String   // 下藥名稱
  tag        String   // tag（抗生素、病毒藥）
  dosage     Float    // 下藥的量（mg/L）
  date       String   // 下藥日期（格式：YYYY-MM-DD）
  notes      String?
  aquariumId Int      @map("aquarium_id")
  aquarium   Aquarium @relation(fields: [aquariumId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("medication_records")
}

model WaterQualityRecord {
  id         Int      @id @default(autoincrement())
  testType   String   @map("test_type") // 檢測種類（NH3+NH4、PH、NO3、NO2）
  testDate   String   @map("test_date") // 檢測日期（格式：YYYY-MM-DD）
  value      Float    // 數值
  notes      String?
  aquariumId Int      @map("aquarium_id")
  aquarium   Aquarium @relation(fields: [aquariumId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("water_quality_records")
}

model Supply {
  id           Int      @id @default(autoincrement())
  name         String   // 耗材名稱
  tag          String   // tag（藥品、濾材、飼料）
  quantity     Float    // 數量
  status       String   // 狀態（使用中、用完、丟棄）
  price        Float?   // 金額
  notes        String?
  purchaseDate String?  @map("purchase_date") // 購買日期（格式：YYYY-MM-DD）
  expiryDate   String?  @map("expiry_date")   // 到期日期（格式：YYYY-MM-DD）
  aquariumId   Int?     @map("aquarium_id")
  aquarium     Aquarium? @relation(fields: [aquariumId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  feedingRecords FeedingRecord[]

  @@map("supplies")
}

model Equipment {
  id           Int      @id @default(autoincrement())
  name         String   // 設備名稱
  tag          String   // tag（燈具、過濾器）
  status       String   // 狀態（使用中、閒置、賣掉、丟棄）
  price        Float?   // 金額
  notes        String?
  purchaseDate String?  @map("purchase_date") // 購買日期（格式：YYYY-MM-DD）
  aquariumId   Int?     @map("aquarium_id")
  aquarium     Aquarium? @relation(fields: [aquariumId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("equipments")
}

